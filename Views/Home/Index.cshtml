@using BlogHub.ViewModels
@{
    if (User.Identity?.IsAuthenticated ?? false)
    {
        Layout = "_Layout";
    }
    else
    {
        Layout = "_Landing";
    }
}
@model HomeViewModel
@section Styles {
    <link rel="stylesheet" href="~/css/profile.css" />
    <link rel="stylesheet" href="~/css/style.css" />
}
<section class="bg-main bg-color bg-transparent p-2 p-md-3 p-lg-5 m-auto m-lg-5 ">
        <div class="container mt-5">
            <div class="row gap-4 gap-lg-0">
                <div class="col-12 col-md-12 col-lg-6 d-flex">
                    <h1 class="pt-auto pt-lg-5">
                        Start your blogging journey at <span class="gradient-text">BlogHub</span>, a place where
                        millions
                        gather
                        to share
                        ideas, insights,
                        and
                        stories.
                    </h1>
                </div>
                <div class="col-12 col-md-12 col-lg-6">
                    <img src="~/assests/hero-section.svg" class=" rounded img-fluid img-thumbnail">
                </div>
            </div>
            <div class="row">
                <div
                    class="col-12 col-md-12 col-lg-6 d-flex align-items-center justify-content-center justify-content-lg-start my-4 my-lg-0">
                    <button class="btn btn-primary">Start Reading</button>
                </div>
            </div>
        </div>
</section>

<section class="p-4 my-2 trending" id="trending">
    <div class="container">
        <div class="row">
            <div class="col-12 my-4">
                <h2 class="text-center text-white">
                    <img src="~/assests/trend.png" class=" rounded  ratio-16x9">
                    Trending Posts
                </h2>
            </div>
        </div>
        <partial name="_TrendingPosts" model="Model.TrendingPosts" />
    </div>
</section>

<section class="p-4 my-2">
    <div class="container my-4">
        <div class="row">
           <partial name="_Categories" model="Model.Categories" />
           @if (Model.RecentlyViewedPosts != null && Model.RecentlyViewedPosts.Any())
           {
                <div class="col-12 col-lg-9 order-2 order-lg-1">
                    <h4 class="my-4 gradient-text">Recently Viewed Posts</h4>
                    @foreach (var post in Model.RecentlyViewedPosts)
                    {
                        <a asp-action="Details" asp-controller="Post" asp-route-id="@post.PostId" style="text-decoration: none; color: inherit;">
                            <div class="mb-3 rounded-4 p-3 shadow-lg border">
                                <div class="mb-2">
                                    <img class="mx-2 rounded-circle" src="~/@post.User.Image?.ImageURL" alt="Author's avatar" style="width:35px;">
                                    <p class=" d-inline">@string.Concat(post.User.FirstName, " ", post.User.LastName)</p>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between gap-2 flex-column flex-sm-row">
                                        <div>
                                            <h5 class="mt-0 fs-3 fw-medium">@post.Title</h5>
                                            <p class="mb-0 text-muted">@post.DatePosted · @post.TimeToRead min read · @post.Category.CategoryName</p>
                                            @{
                                                var plainText = Markdig.Markdown.ToPlainText(post.Content);
                                                var words = plainText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                                                var first35Words = words.Take(35);
                                                var previewText = string.Join(" ", first35Words);
                                                if (words.Length > 35)
                                                {
                                                    previewText += " ...";
                                                }
                                            }
                                            <p>@previewText</p>
                                        </div>
                                        <img src="~/@post.Image?.ImageURL" class="img-fluid rounded-1" style="height:90px">
                                    </div>
                                    
                                </div>
                            </div>
                        </a>
                    }
                </div>
           }

            @if (Model.LatestPosts != null && Model.LatestPosts.Any())
            {
                <div class="col-12 col-lg-9 order-2 order-lg-3">
                    <h4 class="my-4 gradient-text">Latest on BlogHub</h4>
                    @foreach (var post in Model.LatestPosts)
                    {
                        <a asp-action="Details" asp-controller="Post" asp-route-id="@post.PostId" style="text-decoration: none; color: inherit;">
                            <div class="mb-3 rounded-4 p-3 shadow-lg border">
                                <div class="mb-2">
                                    <img class="mx-2 rounded-circle" src="~/@post.User.Image?.ImageURL" alt="Author's avatar" style="width:35px;">
                                    <p class=" d-inline">@string.Concat(post.User.FirstName, " ", post.User.LastName)</p>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between gap-2 flex-column flex-sm-row">
                                        <div>
                                            <h5 class="mt-0 fs-3 fw-medium">@post.Title</h5>
                                            <p class="mb-0 text-muted">@post.DatePosted · @post.TimeToRead min read · @post.Category.CategoryName</p>
                                            @{
                                                var plainText = Markdig.Markdown.ToPlainText(post.Content);
                                                var words = plainText.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                                                var first35Words = words.Take(35);
                                                var previewText = string.Join(" ", first35Words);
                                                if (words.Length > 35)
                                                {
                                                    previewText += " ...";
                                                }
                                            }
                                            <p>@previewText</p>
                                        </div>
                                        <img src="~/@post.Image?.ImageURL" class="img-fluid rounded-1" style="height: 90px;">
                                    </div>

                                </div>
                            </div>
                        </a>
                    }
                </div>
            }
            else
            {
                <div class="col-12 col-lg-9 order-2 order-lg-1">
                    <div class="text-center">
                        <h4 class="text-dark">No posts found.</h4>
                        <a asp-controller="Post" asp-action="Add">Create a new post</a>
                    </div>
                </div>
            }
        </div>
     </div>
</section>